import{S as t,i as e,s as n,j as a,m as l,o as s,v as r,r as o,w as c,z as i,l as f,f as h,B as u,u as $,d as m,G as p,I as d,J as g,L as y,e as v,k as w,c as b,a as k,n as x,b as S,D as T,t as E,g as D,H as j,$ as N,h as H}from"../../../chunks/vendor-483ca6b6.js";import{s as I,o as A}from"../../../chunks/auth-c13ad024.js";import{C,S as F}from"../../../chunks/Spinner-460fa24f.js";import{C as L}from"../../../chunks/Checkbox-6f8586bf.js";import{S as O}from"../../../chunks/Select-2b3a6ae9.js";import{T as Y}from"../../../chunks/Table-c26e4894.js";import{S as q}from"../../../chunks/Section-69710e66.js";function B(t,e,n){const a=t.slice();return a[30]=e[n].title,a}function J(t,e,n){const a=t.slice();return a[23]=e[n],a[24]=e,a[25]=n,a}function P(t,e,n){const a=t.slice();return a[26]=e[n].key,a[27]=N(e[n],["key"]),a}function V(t){let e,n;return e=new F({}),{c(){a(e.$$.fragment)},l(t){l(e.$$.fragment,t)},m(t,a){s(e,t,a),n=!0},p:p,i(t){n||(r(e.$$.fragment,t),n=!0)},o(t){o(e.$$.fragment,t),n=!1},d(t){c(e,t)}}}function _(t){let e,n,i,p,E,D,j,N=""!==t[0]&&"At Hire"!==t[1].filter(t[9])[0].frequency;function H(e){t[10](e)}let I={label:"Safety Type",placeholder:"Safety Type",options:t[4]};void 0!==t[0]&&(I.value=t[0]),n=new O({props:I}),d.push((()=>g(n,"value",H)));let A=N&&M(t),C=t[5].length>0&&z(t);return{c(){e=v("div"),a(n.$$.fragment),p=w(),A&&A.c(),E=w(),C&&C.c(),D=f(),this.h()},l(t){e=b(t,"DIV",{class:!0});var a=k(e);l(n.$$.fragment,a),p=x(a),A&&A.l(a),a.forEach(m),E=x(t),C&&C.l(t),D=f(),this.h()},h(){S(e,"class","w-full flex justify-start space-x-[16px]")},m(t,a){h(t,e,a),s(n,e,null),T(e,p),A&&A.m(e,null),h(t,E,a),C&&C.m(t,a),h(t,D,a),j=!0},p(t,a){const l={};16&a[0]&&(l.options=t[4]),!i&&1&a[0]&&(i=!0,l.value=t[0],y((()=>i=!1))),n.$set(l),3&a[0]&&(N=""!==t[0]&&"At Hire"!==t[1].filter(t[9])[0].frequency),N?A?(A.p(t,a),3&a[0]&&r(A,1)):(A=M(t),A.c(),r(A,1),A.m(e,null)):A&&(u(),o(A,1,1,(()=>{A=null})),$()),t[5].length>0?C?(C.p(t,a),32&a[0]&&r(C,1)):(C=z(t),C.c(),r(C,1),C.m(D.parentNode,D)):C&&(u(),o(C,1,1,(()=>{C=null})),$())},i(t){j||(r(n.$$.fragment,t),r(A),r(C),j=!0)},o(t){o(n.$$.fragment,t),o(A),o(C),j=!1},d(t){t&&m(e),c(n),A&&A.d(),t&&m(E),C&&C.d(t),t&&m(D)}}}function M(t){let e,n,i;function f(e){t[11](e)}let h={label:"Period",placeholder:"Period",options:t[6]};return void 0!==t[3]&&(h.value=t[3]),e=new O({props:h}),d.push((()=>g(e,"value",f))),{c(){a(e.$$.fragment)},l(t){l(e.$$.fragment,t)},m(t,n){s(e,t,n),i=!0},p(t,a){const l={};64&a[0]&&(l.options=t[6]),!n&&8&a[0]&&(n=!0,l.value=t[3],y((()=>n=!1))),e.$set(l)},i(t){i||(r(e.$$.fragment,t),i=!0)},o(t){o(e.$$.fragment,t),i=!1},d(t){c(e,t)}}}function z(t){let e,n;return e=new Y({props:{$$slots:{tbody:[X],thead:[R]},$$scope:{ctx:t}}}),{c(){a(e.$$.fragment)},l(t){l(e.$$.fragment,t)},m(t,a){s(e,t,a),n=!0},p(t,n){const a={};32&n[0]|4&n[1]&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){n||(r(e.$$.fragment,t),n=!0)},o(t){o(e.$$.fragment,t),n=!1},d(t){c(e,t)}}}function G(t){let e,n,a=t[30]+"";return{c(){e=v("th"),n=E(a),this.h()},l(t){e=b(t,"TH",{class:!0});var l=k(e);n=D(l,a),l.forEach(m),this.h()},h(){S(e,"class",nt)},m(t,a){h(t,e,a),T(e,n)},p:p,d(t){t&&m(e)}}}function R(t){let e,n,a,l,s=t[8],r=[];for(let o=0;o<s.length;o+=1)r[o]=G(B(t,s,o));return{c(){e=v("thead"),n=v("th"),a=E("Completed"),l=w();for(let t=0;t<r.length;t+=1)r[t].c();this.h()},l(t){e=b(t,"THEAD",{slot:!0});var s=k(e);n=b(s,"TH",{class:!0});var o=k(n);a=D(o,"Completed"),o.forEach(m),l=x(s);for(let e=0;e<r.length;e+=1)r[e].l(s);s.forEach(m),this.h()},h(){S(n,"class",nt+" w-[24px]"),S(e,"slot","thead")},m(t,s){h(t,e,s),T(e,n),T(n,a),T(e,l);for(let n=0;n<r.length;n+=1)r[n].m(e,null)},p(t,n){if(256&n[0]){let a;for(s=t[8],a=0;a<s.length;a+=1){const l=B(t,s,a);r[a]?r[a].p(l,n):(r[a]=G(l),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=s.length}},d(t){t&&m(e),j(r,t)}}}function K(t){let e,n=t[23][t[26]]+"";return{c(){e=E(n)},l(t){e=D(t,n)},m(t,n){h(t,e,n)},p(t,a){32&a[0]&&n!==(n=t[23][t[26]]+"")&&H(e,n)},i:p,o:p,d(t){t&&m(e)}}}function Q(t){let e,n,i;return n=new L({}),{c(){e=v("div"),a(n.$$.fragment),this.h()},l(t){e=b(t,"DIV",{class:!0});var a=k(e);l(n.$$.fragment,a),a.forEach(m),this.h()},h(){S(e,"class","flex justify-center")},m(t,a){h(t,e,a),s(n,e,null),i=!0},p:p,i(t){i||(r(n.$$.fragment,t),i=!0)},o(t){o(n.$$.fragment,t),i=!1},d(t){t&&m(e),c(n)}}}function U(t){let e,n,a,l;const s=[Q,K],c=[];var i;return n="checkbox"===(null==(i=t[27])?void 0:i.type)?0:1,a=c[n]=s[n](t),{c(){e=v("td"),a.c(),this.h()},l(t){e=b(t,"TD",{class:!0});var n=k(e);a.l(n),n.forEach(m),this.h()},h(){S(e,"class",nt)},m(t,a){h(t,e,a),c[n].m(e,null),l=!0},p(t,e){a.p(t,e)},i(t){l||(r(a),l=!0)},o(t){o(a),l=!1},d(t){t&&m(e),c[n].d()}}}function W(t){let e,n,i,f,p,E,D,N;function H(e){t[12](e,t[23])}let I={};void 0!==t[23].checked&&(I.checked=t[23].checked),f=new L({props:I}),d.push((()=>g(f,"checked",H))),f.$on("change",(function(...e){return t[13](t[23],...e)}));let A=t[8],C=[];for(let a=0;a<A.length;a+=1)C[a]=U(P(t,A,a));const F=t=>o(C[t],1,1,(()=>{C[t]=null}));return{c(){e=v("tr"),n=v("td"),i=v("div"),a(f.$$.fragment),E=w();for(let t=0;t<C.length;t+=1)C[t].c();D=w(),this.h()},l(t){e=b(t,"TR",{class:!0});var a=k(e);n=b(a,"TD",{class:!0});var s=k(n);i=b(s,"DIV",{class:!0});var r=k(i);l(f.$$.fragment,r),r.forEach(m),s.forEach(m),E=x(a);for(let e=0;e<C.length;e+=1)C[e].l(a);D=x(a),a.forEach(m),this.h()},h(){S(i,"class","flex justify-center"),S(n,"class",nt),S(e,"class","rounded transition duration-200 bg-white bg-opacity-0 hover:bg-opacity-[2%]")},m(t,a){h(t,e,a),T(e,n),T(n,i),s(f,i,null),T(e,E);for(let n=0;n<C.length;n+=1)C[n].m(e,null);T(e,D),N=!0},p(n,a){t=n;const l={};if(!p&&32&a[0]&&(p=!0,l.checked=t[23].checked,y((()=>p=!1))),f.$set(l),288&a[0]){let n;for(A=t[8],n=0;n<A.length;n+=1){const l=P(t,A,n);C[n]?(C[n].p(l,a),r(C[n],1)):(C[n]=U(l),C[n].c(),r(C[n],1),C[n].m(e,D))}for(u(),n=A.length;n<C.length;n+=1)F(n);$()}},i(t){if(!N){r(f.$$.fragment,t);for(let t=0;t<A.length;t+=1)r(C[t]);N=!0}},o(t){o(f.$$.fragment,t),C=C.filter(Boolean);for(let e=0;e<C.length;e+=1)o(C[e]);N=!1},d(t){t&&m(e),c(f),j(C,t)}}}function X(t){let e,n,a=t[5],l=[];for(let r=0;r<a.length;r+=1)l[r]=W(J(t,a,r));const s=t=>o(l[t],1,1,(()=>{l[t]=null}));return{c(){e=v("tbody");for(let t=0;t<l.length;t+=1)l[t].c();this.h()},l(t){e=b(t,"TBODY",{slot:!0});var n=k(e);for(let e=0;e<l.length;e+=1)l[e].l(n);n.forEach(m),this.h()},h(){S(e,"slot","tbody")},m(t,a){h(t,e,a);for(let n=0;n<l.length;n+=1)l[n].m(e,null);n=!0},p(t,n){if(416&n[0]){let o;for(a=t[5],o=0;o<a.length;o+=1){const s=J(t,a,o);l[o]?(l[o].p(s,n),r(l[o],1)):(l[o]=W(s),l[o].c(),r(l[o],1),l[o].m(e,null))}for(u(),o=a.length;o<l.length;o+=1)s(o);$()}},i(t){if(!n){for(let t=0;t<a.length;t+=1)r(l[t]);n=!0}},o(t){l=l.filter(Boolean);for(let e=0;e<l.length;e+=1)o(l[e]);n=!1},d(t){t&&m(e),j(l,t)}}}function Z(t){let e,n,a,l;const s=[_,V],c=[];function i(t,e){return t[2]?0:1}return e=i(t),n=c[e]=s[e](t),{c(){n.c(),a=f()},l(t){n.l(t),a=f()},m(t,n){c[e].m(t,n),h(t,a,n),l=!0},p(t,l){let f=e;e=i(t),e===f?c[e].p(t,l):(u(),o(c[f],1,1,(()=>{c[f]=null})),$(),n=c[e],n?n.p(t,l):(n=c[e]=s[e](t),n.c()),r(n,1),n.m(a.parentNode,a))},i(t){l||(r(n),l=!0)},o(t){o(n),l=!1},d(t){c[e].d(t),t&&m(a)}}}function tt(t){let e,n;return e=new C({props:{class:"items-center space-y-[16px]",$$slots:{default:[Z]},$$scope:{ctx:t}}}),{c(){a(e.$$.fragment)},l(t){l(e.$$.fragment,t)},m(t,a){s(e,t,a),n=!0},p(t,n){const a={};127&n[0]|4&n[1]&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){n||(r(e.$$.fragment,t),n=!0)},o(t){o(e.$$.fragment,t),n=!1},d(t){c(e,t)}}}function et(t){let e,n;return e=new q({props:{$$slots:{default:[tt]},$$scope:{ctx:t}}}),{c(){a(e.$$.fragment)},l(t){l(e.$$.fragment,t)},m(t,a){s(e,t,a),n=!0},p(t,n){const a={};127&n[0]|4&n[1]&&(a.$$scope={dirty:n,ctx:t}),e.$set(a)},i(t){n||(r(e.$$.fragment,t),n=!0)},o(t){o(e.$$.fragment,t),n=!1},d(t){c(e,t)}}}const nt="p-[10px]";function at(t,e,n){let a,l;const s=async()=>{const t=await I(`/api/datatable/roles?sort=${JSON.stringify({name:1})}`);$=t.rows},r=async()=>{const t=await I("/api/datatable/safety-history");m=t.rows},o=async()=>{const t=await I(`/api/datatable/safety-types?sort=${JSON.stringify({name:1})}`);n(1,d=t.rows),n(4,g=[{label:"-- Select a Safety Item",value:""},...t.rows.map((t=>({label:t.name,value:t.name})))])},c=async()=>{const t=await I(`/api/datatable/users?sort=${JSON.stringify({firstName:1,lastName:1})}`);y=t.rows},f=async(t,{_id:e})=>{const n=t.target.checked,a={id:e,safetyType:p};""!==u&&(a.period=u),n||await I({method:"DELETE",href:`/api/datatable/safety-history?${A(a)}`}),n&&await I({method:"POST",href:"/api/datatable/safety-history",body:a}),await r()};let h=!1,u="",$=[],m=[],p="",d=[],g=[],y=[];i((async()=>{await Promise.all([s(),r(),o(),c()]),n(2,h=!0)}));return t.$$.update=()=>{1&t.$$.dirty[0]&&n(5,a=""===p?[]:(()=>{const t=[...$].filter((t=>t.safetyItems.map((t=>t.name)).includes(p))).map((t=>t.name));return[...y].filter((e=>e.roles.filter((e=>t.includes(e))).length>0)).map((t=>(t.checked=1===[...m].filter((e=>e.id===t._id&&e.safetyType===p)).length,t)))})()),1&t.$$.dirty[0]&&n(6,l=""===p?[]:(()=>{const t=new Date,e=t.getMonth(),a=t.getFullYear(),l=2020,s=[...d].filter((({name:t})=>t===p))[0].month,r=12*(a-l)-s+e,o=Math.ceil(r/12),c=[...Array(o).keys()].map(((t,e)=>{const n=new Date(l+e,s,1),a=new Date(l+e,s+11,1);return{label:`${n.toLocaleString("default",{month:"long"})} ${n.getFullYear()} - ${a.toLocaleString("default",{month:"long"})} ${a.getFullYear()}`,value:n.getFullYear().toString()}})).reverse();return n(3,u=c[0].value),c})()),3&t.$$.dirty[0]&&(""!==p&&"At Hire"!==d.filter((t=>t.name===p))[0].frequency||n(3,u=""))},[p,d,h,u,g,a,l,f,[{title:"First Name",key:"firstName"},{title:"Last Name",key:"lastName"}],t=>t.name===p,function(t){p=t,n(0,p)},function(t){u=t,n(3,u),n(0,p),n(1,d)},function(e,l){t.$$.not_equal(l.checked,e)&&(l.checked=e,n(5,a),n(0,p))},(t,e)=>f(e,t)]}export default class extends t{constructor(t){super(),e(this,t,at,et,n,{},[-1,-1])}}
